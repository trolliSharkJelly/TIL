# optimization

## 최적화 기법

### 최적화의 개념

- 주어진 상황에서 원하는 가장 알맞은 결과를 어들 수 있도록 처리하는 과정
- 분야에 따라 의미가 조금씩 다르지만 최적화는 보통 주어진 조건으로 최대 효율을 낼 수 있도록 하는 것을 의미
- 예시) 컴퓨터공학에서의 최적화란 '가능한 적은 리소스를 소모하면서 가능한 한 빠르게 원하는 결과를 얻을 수 있도록 하는 것'
- 웹 개발에서의 최적화란 '주어진 조건 아래에서 최대한 빠르게 화면을 표시하도록 만드는 것'

### 최적화의 필요성 및 효과

1. 이탈률 감소
   최적화가 잘 되지 않은 웹 페이지는 화면 로딩 시간이 보다 소요되므로 로딩 시간이 길어지면 사용자가 페이지를 이탈할 확률이 높아진다. 페이지 로드 속도가 1초에서 3초로 늘어나기만해도 이탈률이 32%로 나타나며, 성능 최적화를 통해 페이지 로딩 속도를 줄이면 사용자의 이탈률을 줄일 수 있다.

2. 전환률 증가
   이탈률이 줄어들면 전환률이 높아질 확률도 크다. 전환률이란 웹 사이트를 방문한 사용자 중 회원가입, 상품 구매, 다운로드 등의 행위를 한 방문자의 비율을 의미한다. 화면이 제대로 표시되어도 방문자를 실제 서비스 이용자로 전환하게 하는 일은 어려운 일이지만 전환률을 늘려 서비스 사용자를 늘리기 위해서는 이탈률을 줄여야 한다.

3. 수익 증가
   빠른 웹 사이트의 로딩 속도는 수익 증대까지 이어질 수 있다. 실제로 로딩 속도가 빨라졌을 때 아마존 판매량은 1%, 월마트의 전환률은 2% 증가했다고 하며, 퍼센트는 작지만 해당 수치를 돈으로 환산 했을 시 68억 달러, 2억 4천 400만 달러의 매출 증가이다. 꼭 해당 사이트처럼 규모가 크지 않은 서비스라도 로딩 속도의 차이는 유의미한 수익 차이를 낼 수 있다.

4. 사용자 경험(UX) 향상
   최적화는 효과적인 UX 개선 수단이다. 페이지 로딩이 빠를 수록 UX가 향상되기 때문에 이미 페이지 속도가 빨라도 최적화를 통해 UX를 더욱 향상시킬 수 있다. 로딩이 오래 걸릴 경우엔 프로그레스바, 스켈레톤과 같이 로딩 중임을 알려주는 UI를 표시하여 방문자가 조금 더 기다리게 하는 방법도 있다. 하지만 이는 방문자의 체류시간이 늘어날 뿐, 페이지의 로드 속도가 개선되지 않는다면 이탈률 개선까지 이어지기 어려우므로 이탈률 감소와 UX 향상 효과를 동시에 보기 위해서는 웹 사이트 성능 최적화를 진행하는 것이 좋다.

## 최적화 기법

### HTML, CSS 코드 최적화하기

HTML 파일은 DOM 트리, CSS 파일은 CSSOM 트리를 만들고 두 트리를 결합하여 렌더링 시 사용한다. 두 트리 중 하나라도 변경 시 리렌더링을 유발하는데 트리의 크기가 크고 복잡할수록 더 많은 계산이 필요하기 때문에 리렌더링에 소모되는 시간도 길어진다. HTML, CSS 코드를 최적화함으로써 렌더링 성능을 향상시킬 수 있다.

1. HTML 최적화 방법  
   (1) DOM 트리 가볍게 만들기  
   DOM 트리가 깊을수록, 자식 요소가 많을수록 DOM 트리의 복잡도는 커진다. 
   복잡도가 클수록 DOM 트리 변경 시 계산하는 것도 많아지므로 HTML 요소간 관계를 살펴보고 불필요하게 깊이를 증가시키는 요소가 있다면 삭제한다.

```html
<!-- 수정 전 -->
<div>
  <ol>
    <li>첫 번째</li>
    <li>두 번째</li>
    <li>세 번째</li>
  </ol>
</div>

<!-- 수정 후 : 불필요한 div 요소 제거 -->
<div>
  <ol>
    <li>첫 번째</li>
    <li>두 번째</li>
    <li>세 번째</li>
  </ol>
</div>
```

(2) 인라인 스타일 사용하지 않기  
인라인 스타일은 개별 요소에 스타일 속성을 정의하는 것이다. 인라인 스타일 사용 시클래스로 한 번에 작성해도 될 스타일 속성을 중복으로 작성하게 되는 경우가 생기므로 가독성을 떨어트리거나 파일 크기가 증가되는 문제가 발생할 수 있다. CSS 파일을 따로 작성하지 않고 인라인 스타일을 사용한다면 리플로우를 계속 발생시켜 렌더링 완료 시점을 늦추며 웹 표준에 맞지 않으므로 지양해야 한다.

```html
<!-- 수정 전 -->
<div style="padding: 10px">패딩1 10px</div>
<div style="padding: 10px">패딩2 10px</div>

<!-- 수정 후 : class와 CSS로 대체 -->
<div class="padding10">패딩1 10px</div>
<div class="padding10">패딩2 10px</div>

.padding10 { padding: 10px; }
```

2. CSS 최적화 방법  
   (1) 사용하지 않는 CSS 제거하기    
   CSS 파일의 코드 분석이 끝난 후 CSSOM 트리가 생성되며, 불필요한 CSS 코드가 잇다면 CSSOM 트리 완성이 늦어지기 때문에 사용하지 않는 CSS 코드가 있다면 제거하는 것이 좋다.  

   (2) 간결한 셀렉터 사용하기   
   셀렉터가 복잡할수록 스타일 계산과 레이아웃에 시간을 많이 소모하게 되므로 간결한 셀렉터를 사용하는 것이 좋다.  

```html
   // 복잡한 CSS 셀렉터 예시
   .cart_page .cart_item #firstItem {
     ...;
   }

   // 간결한 셀렉터
   .cart_item {
     ...;
   }
```

### 리소스 로딩 최적화하기

HTML에서 JavaScript 파일과 CSS 파일을 불러올 때 위치에 따라 렌더링 완료 시점이 달라질 수 있다.

1. CSS 파일 불러오기  
   DOM트리는 HTML 코드를 한 줄 한 줄 읽으며 순차적으로 구성하지만 CSSOM 트리는 CSS 코드를 모두 해석해야 구성할 수 있다. 따라서 CSS는 HTML 문서 최상단에 배치하는 것이 좋다.

```html
<head>
  <link href="style.css" rel="steylesheet" />
</head>
```

2. JavaScript 파일 불러오기  
HTML 코드 파싱 중에 `<script>` 요소를 만나는 순간 해당 스크립트가 실행되며 `<script>`
요소 이전까지 생성된 DOM 까지만 접근할 수 있다.
스크립트 실행이 완료되기 전까지 DOM 트리 생성이 중단되며 JavaScript 파일을 다운받아와서
사용하는 경우 스크립트 실행이 완료될 때까지 DOM 트리 생성이 중단된다. DOM 트리 생성이 중단된 시간만큼 
렌더링 완료 시간은 늦춰지게 되므로 JavaScript 파일은 DOM 트리 생성이 완료되는 시점인
HTML 문서 최하단에 배치하는 것이 좋다.  

```html
<body>
  ...
  <script src="index.js" type="text/javascript"/>
</body>
```

# virtualDOM

## 정의
- **react 공식 홈페이지에서의 virtualDOM**  
Virtual DOM (VDOM)은 UI의 이상적인 또는 “가상”적인 표현을 메모리에 저장하고 ReactDOM과 같은 라이브러리에 의해 “실제” DOM과 동기화하는 프로그래밍 개념  

- React에는 Virtual DOM이라고 하는 가상의 DOM 객체가 있는데 이 가상의 DOM 객체는 실제 DOM의 사본 같은 개념이다.
React는 실제 DOM 객체에 접근하여 조작하는 대신 이 가상의 DOM 객체에 접근하여 변화 전/후를 비교하고 바뀐 부분만 적용할 수 있게 된다.


### VirtualDOM 탄생 배경

#### - DOM의 개념
Document Object Model의 약자로 문자 그대로 해석하면 문자 객체 모델이다. 
문서 객체란 브라우저가 JavaScript과 같은 스크립팅 언어가 `<html>`, `<head>`, `<body>`와 같은 태그들에 접근하고 조작할 수 있도록 태그들을 트리 구조로 객체화 시킨 것이다. 
트리 구조로 DOM 객체가 이뤄져 있기 때문에 JavaScript는 쉽게 DOM 객체에 접근할 수 있고, DOM 객체를 조작할 수 있게 된다.

#### - DOM의 조작 속도가 느려지는 이유
DOM은 계층적 구조로 되어 있는 트리다. 자료구조 중 트리는 "데이터 저장"의 의미보다 **"저장된 데이터를 더 효과적으로 탐색"** 하기 위해 사용되므로, 빠른 자료 탐색 성능이 장점인 자료구조이다.
트리구조인 DOM은 JavaScript와 같은 스크립팅 언어가 접근하고 탐색하는 속도가 빠르기 때문에 변경 및 업데이트 속도 또한 빠르다.  
그러나 DOM의 변경 및 업데이트는 브라우저의 렌더링 엔진 또한 리플로우(reflow)한다는 것을 의미한다. 
브라우저의 리플로우와 리페인트 과정은 레이아웃 및 페인트에 해당하는 재연산을 해야하기 때문에 속도가 그만큼 느려진다.  
JavaScript로 조작하는 DOM 요소가 많을수록 모든 DOM 업데이트에 대해 리플로우를 해야하므로 DOM의 업데이트에 대한 비용이 많이 들게 된다. 
과도한 reflow를 피하기 위해 되도록 DOM에 접근하여 작업하는 것을 피해야 한다. 
결국 바뀐 부분만 비교해서 그 부분만 렌더링을 할 수 없을까?라는 아이디어를 기반으로 React는 VirtualDOM을 만들었다. 

### VirtualDOM
React는 모든 DOM 객체에 대응하는 가상의 DOM 객체가 있다. 가상 DOM 객체는 화면에 표시되는 내용을 실제 DOM 객체처럼 직접 변경하지 않는다.

- **어떻게 가상 DOM이 더 빠를까?**  
React는 새로운 요소가 UI에 추가되면 트리 구조로 표현이 되는 가상의 DOM이 만들어지며, 해당 요소의 상태가 변경되면 다시 새로운 가상의 DOM 트리가 만들어진다.  
이전의 가상 DOM과 상태 변경 후의 가상 DOM의 차이를 비교한다.  
가상의 DOM은 실제 DOM에 변경을 수행할 수 있는 방법을 계산하며, 이렇게 하면 실제 DOM은 최소한의 작업만 수행해도 렌더링을 할 수 있게 된다.  
실제 DOM의 업데이트 비용을 줄일 수 있게 되며 이는 브라우저의 파워를 덜 쓴다는 의미로 더 빠른 렌더링이 가능해진다
아래 그림은 가상 DOM 트리가 실제 DOM 트리에 적용되는 과정이다.
![스크린샷 2022-07-27 오후 7 38 50](https://user-images.githubusercontent.com/99730280/181227520-a6c46984-77ce-4785-80d4-05e3c2f118d7.png)

노란색 원은 업데이트 된 노드, 즉 UI를 의미한다.  
React에서는 상태가 변경된 UI요소이며, 가상 DOM 트리의 이전버전과 현재 가상 DOM 트리 간의 차이가 계산된다.  
그 다음 트리가 업데이트 된 UI를 제공하기 위해 부분적으로 리렌더링 되며 업데이트 된 트리는 실제 DOM으로 한꺼번에 업데이트 된다.  


- **참고 사이트**  
https://dantechblog.gatsbyjs.io/posts/dom-virtualdom/  
https://dev-cini.tistory.com/11
